<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <title>创建ManicTime的服务器 | 阿凸日记</title>    
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="在Nas里建立MacnicTime的服务器的正确姿势">
<meta name="referrer" content="same-origin">
<meta name="generator" content="Hugo 0.82.0" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
  <meta property="og:title" content="创建ManicTime的服务器" />
<meta property="og:description" content="在Nas里建立MacnicTime的服务器的正确姿势" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//atutang.com/2021/03/starting-manictime-server-on-docker/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-27T09:05:30&#43;08:00" />
<meta property="article:modified_time" content="2021-04-18T14:07:23&#43;08:00" />




<link rel="stylesheet" href="//atutang.com/scss/style.min.473bdc2914cbf90a78182161eb68d8d3243bdc74bdf7f3f100209482cedb03995d73e81042c649cdc2be53fa7808c2e894d1c9e46b55871d36d2dae3e9682ec5.css" integrity="sha512-RzvcKRTL&#43;Qp4GCFh62jY0yQ73HS99/PxACCUgs7bA5ldc&#43;gQQsZJzcK&#43;U/p4CMLolNHJ5GtVhx020trj6WguxQ==" media="screen">

<script src="/js/prism.js"></script>
<link rel="stylesheet" href="/css/prism.css">
<link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">

<style>@import url('https://fonts.googleapis.com/css2?family=Fira+Code&Cousine&family=Montserrat&family=Noto+Sans+SC:wght@400;700&Oswald:wght@400;700&family=Noto+Serif+SC:wght@300;400;700&display=swap');</style>
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />








<script src="https://kit.fontawesome.com/fa02392c8f.js" crossorigin="anonymous"></script>
    </head>
    <body>




<div class="singlepage wrap">
  <div class="head-wrapper" style="background: url('/images/posthead.webp');background-size:cover;background-position:center;">
    <div class="topinfo">
      <a href="//atutang.com">
        <img src="/images/sitelogo-small.png" alt="sitelogo">
      </a>
      <span class="path">
          <a href="//atutang.com">首页</a> / <a href="/posts/">归档 </a>
      </span>
      <span class="tags">
        TAG：
          
            <a href="//atutang.com/tags/%E6%8A%98%E8%85%BE" >折腾</a>
          
            <a href="//atutang.com/tags/nas" >nas</a>
          
        
      </span>
    </div>
    <div class="post-title">

        

        <h1>创建ManicTime的服务器</h1>
        <div class="post-meta">
            <span>
                2021-03-27
              </span>
              <span class="split">
                ·
              </span>
              <span>
                
                  约2520字
                
              </span>
              <span class="split">
                ·
              </span>
              <span>
                需时6分钟
              </span>
        </div>
    </div>
  </div>
  <div class="content">
      <h2 id="开搞前-text">开搞前 text</h2>
<p>关于ManicTime（后文称MT）是什么，在之前的一篇博客里有详细介绍过，自己用了一段时间下来，拖延症的症状得到了明显的改善，每天的时间安排也变得更加有序了，就想着看看手机端是什么亚子的，结果打开手机直接显示要登陆MT，这哪行，一定要看到APP端的界面才行。</p>
<p><img src="https://30924398.xyz:6001/images/2021/03/28/image-20210328091813533.png#center" alt="image-20210328091813533"></p>
<p>本想着直接抄袭下现成的作业就好了，无奈这款软件实在小众，中文搜索到的都是关于怎么用客户端的水文，没有现成的配置服务器的作业可以抄，谷歌搜到的相关内容都不多。那只能发挥靠天靠地靠祖上，不如靠自己的折腾精神了。话不多说，开搞。</p>
<h2 id="服务器的选择">服务器的选择</h2>
<p>官方提供了两种搭建服务器的选择，<strong>付费选择官方提供的云服务器</strong>以及<strong>自行搭建服务器</strong>。前者貌似是订阅版才可以使用，我目前还是在产品的试用期，那自然就只能选择自建服务器（这个选项也是需要Pro版的）了。</p>
<p><img src="https://30924398.xyz:6001/images/2021/03/28/image-20210328092521980.png#center" alt="image-20210328092521980"></p>
<p>在自行搭建服务器的基础上，有三个版本可以选择：</p>
<ul>
<li>Windows</li>
<li>Linux</li>
<li>Docker</li>
</ul>
<p>刚好手上有群晖的Nas，所以选择了Docker，后面就因为对Docker的不了解，绕了一些弯路</p>
<h2 id="误以为的安装过程">误以为的安装过程</h2>
<p>安装过程回过头来看其实不难，只是其中有一些知识盲区，所以饶了一些弯路。<strong>原本以为</strong>整个安装过程无非就是下面几步：</p>
<ol>
<li>在群里Dcoker中下载MT容器；</li>
<li>在NAS中创建供MT使用的文件夹；</li>
<li>在容器启动的配置项里填好上一步创建好的文件夹以及装载路径；</li>
<li>通过SSH连接到NAS中创建好服务器账号密码；</li>
<li>通过SSH连接到NAS中启动MT服务器。</li>
</ol>
<p>需要注意的是，在SSH中进行DOCKER的相关操作需要ROOT权限，SSH连接成功后，输入<code>sudo -i</code>后重新输入一次nas密码即可切换到ROOT账号下了。</p>
<p><img src="https://raw.githubusercontent.com/tsq456/picBed/master/image-20210328140527775.png#center" alt="image-20210328140527775"></p>
<p>这几步中自己主要是在第3和第5步卡住了，这里简单记录下。</p>
<h3 id="容器的安装目录和装载路径">容器的安装目录和装载路径</h3>
<p>因为在<a href="https://hub.docker.com/r/manictime/manictimeserver/">MT容器的说明</a>里关于容器的安装就简单的两个步骤：创建账号密码以及启动服务器（即上面提到的4、5两步），而关于创建账号密码的说明只有下面简单的一行Docker命令。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile">docker run -v /var/lib/manictimeserver/Data:/app/Data --rm --entrypoint dotnet  manictime/manictimeserver ManicTimeServer.dll addadmin -u &lt;admin email&gt; -p &lt;admin password&gt;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>因为原本对Docker的了解也就局限于群晖上的一些类似迅雷下载这样的实际应用，再加上后来玩ESXi时候知道了原来Docker也是一种虚拟技术，并且基本也都是抄别人作业，在此之外就再无任何了解了。因此也就有些搞不懂在Nas下创建容器时是否需要预先设置一些参数。</p>
<p>后来发现上面命令中<code>/var/lib/manictimeserver/Data:/app/Data</code>这一段路径代码里提到了两个路径，就尝试着在容器高级设置里面的卷分页签下装在路径填上<code>/app/Data</code>，之后就可以了。</p>
<p><img src="https://raw.githubusercontent.com/tsq456/picBed/master/image-20210328142335054.png#center" alt="image-20210328142335054"></p>
<p>但是这里还有个没弄清楚的地方就是在于前面这个路径<code>/var/lib/manictimeserver/Data</code>代表什么，因为在卷里面选择的文件夹可以是自己创建的文件夹，但是在创建账号密码时使用的命令中又可以包含这串路径。而且在成功创建服务器后，这两个路径下都会有相同的文件。</p>
<p><img src="https://raw.githubusercontent.com/tsq456/picBed/master/image-20210328143817392.png#center" alt="111"></p>
<p><img src="https://raw.githubusercontent.com/tsq456/picBed/master/image-20210328143842959.png#center" alt="image-20210328143842959"></p>
<blockquote>
<p>写这篇的时候顺道搜索了下Docker的一些说明文档，原来<code>/var/lib/manictimeserver/Data:/app/Data</code>这行命令的意思是将宿主机（Nas）的目录<code>/var/lib/manictimeserver/Data</code>挂载到容器的<code>/app/Data</code>下。</p>
<p>因此如果是在群晖中已经创建好MT数据的存储路径DirA，并且在群晖Docker下高级配置填写了/app/Data的情况下，最开始那行命令应该是下面这段命令</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile">docker run -v DirA:/app/Data --rm --entrypoint dotnet  manictime/manictimeserver ManicTimeServer.dll addadmin -u &lt;admin email&gt; -p &lt;admin password&gt;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>所以如果不想在宿主机里出现两份MT数据的话，其实就是需要制定上面提到的DirA为自己创建的数据库路径。因此，其实就没有所谓的第3步。</p>
<h3 id="启动容器">启动容器</h3>
<p>在<a href="https://hub.docker.com/r/manictime/manictimeserver/">MT容器的说明</a>里关于启动服务器通用也是一行简单的命令。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile">docker run -v /var/lib/manictimeserver/Data:/app/Data -p 8080:8080 manictime/manictimeserver<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>那其实经过上面带冒号的路径的理解后，这里的带冒号的前后端口号就也相对好理解了，其实就是将容器的8080端口映射到宿主机的8080端口，以下搜到的这段话可以更好地帮助理解。</p>
<blockquote>
<p>8080：80表示在容器中您正在使用端口80，并将该端口转发到主机的8080端口。因此，在方案2中的任何位置，您都在容器内的端口80上运行Jenkins，并且在容器内的端口8080上运行Jenkins，并将其暴露在主机的同一端口上。
例如，如果我在容器中运行mysql，则可能会使用8080：3306，因此mysql将在端口3306上运行，但在主机的8080上暴露，但是如果为mysql选择8080：80，则它可能无法工作，因为按照mysql的代码，它绑定在端口3306而不是端口80上。在您的詹金斯案例中，情况也是如此。</p>
</blockquote>
<p>因此，如果你的命令中的端口号是<code>1234:6789</code>就是指定容器运行在Docker的6789端口，但是转发到宿主机的1234端口（这样后续如果要在nas中做外网的端口暴露，需要映射的就是1234端口）。</p>
<h2 id="真实的安装过程">真实的安装过程</h2>
<p>因此，重新归纳一遍安装MTServer的流程就是。</p>
<ol>
<li>在群里Dcoker中下载MTServer的容器镜像；</li>
<li>在NAS中创建供MT使用的文件夹**（目录DirA，群辉文件夹的真实路径一般是/volumN/共享文件夹文件夹名/下级文件夹名，可通过右键-属性查看）**；</li>
<li>创建容器时无需配置任何信息，直接启动；</li>
<li>通过SSH连接到NAS，将容器挂载到第2部创建好的文件夹路径下并创建好服务器的账号密码，命令是<code>docker run -v DirA:/app/Data --rm --entrypoint dotnet  manictime/manictimeserver ManicTimeServer.dll addadmin -u &lt;admin email&gt; -p &lt;admin password&gt;</code>，其中-u后面就是设定的账号，-p后面就是设定的密码，自行替换。</li>
</ol>
<p><img src="https://30924398.xyz:6001/images/2021/03/28/image-20210328153647113.png#center" alt="image-20210328153647113"></p>
<ol start="5">
<li>启动MT服务器，命令是<code>docker run -v DirA:/app/Data -p 1234:5678 manictime/manictimeserver</code>其中1234是MTserver在宿主机中的运行端口号，5678是其在Docker中的运行端口号，不要与其他程序或者容器发生冲突。</li>
</ol>
<p><img src="https://30924398.xyz:6001/images/2021/03/28/image-20210328153725815.png#center" alt="image-20210328153725815"></p>
<p>启动成功后，在容器里会自动创建一个随机命名的新容器。</p>
<p><img src="https://30924398.xyz:6001/images/2021/03/28/image-20210328154102067.png#center" alt="image-20210328154102067"></p>
<p>再之后 可以在浏览器里输入你的nas内网地址+端口号访问MT Server的服务端了，输入之后创建时候设置的账号密码就可以进到服务端的管理台了。</p>
<h2 id="总结">总结</h2>
<p>碰到问题多读文档，其实问题的根源就在于不懂docker挂载的命令格式，碰到路径之间加冒号就懵逼了。</p>

  </div>
  <div class="post-end-info">
    <i class="post-end">POST END</i>
    <i class="last-mod-time">最后编辑于：2021-04-18 14:07</i>
  </div>

  <nav class="post-pagination">

    
    <div class="prewrap active">
        <span class="material-icons">arrow_back</span>
        <a href="//atutang.com/2021/03/centering-images-in-hugo/" title="怎么在hugo里居中对齐图片">怎么在hugo里居中对齐图片</a>
    </div>
    
    
    
    <div class="nextwrap active">
        <a href="//atutang.com/2021/03/how-to-build-a-game-shortcode/" title="创建游戏卡片Shortcode">创建游戏卡片Shortcode&nbsp;</a>
        <span class="material-icons">arrow_forward</span>
    </div>
    
</nav>
  <script src="/js/backtotop.js"></script>
<script>addBackToTop({
    diameter: 50,
    backgroundColor: '#2d2d2d',
    textColor: '#ffffff'
  })</script>
  
    
 
<div id="waline"></div>
<script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
<script>
  new Waline({
    el: '#waline',
    path: location.pathname,
    serverURL: 'https://blogcomment-one.vercel.app',
    visitor: true,
    avatar: 'robohash',

    emojiCDN: '//i0.hdslb.com/bfs/emote/',
    emojiMaps: {
      "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png@32w_32h.webp",
      "tv_亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png@32w_32h.webp",
      "tv_偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png@32w_32h.webp",
      "tv_再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png@32w_32h.webp",
      "tv_冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png@32w_32h.webp",
      "tv_发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png@32w_32h.webp",
      "tv_发财": "34db290afd2963723c6eb3c4560667db7253a21a.png@32w_32h.webp",
      "tv_可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png@32w_32h.webp",
      "tv_吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png@32w_32h.webp",
      "tv_呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png@32w_32h.webp",
      "tv_呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png@32w_32h.webp",
      "tv_困": "241ee304e44c0af029adceb294399391e4737ef2.png@32w_32h.webp",
      "tv_坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png@32w_32h.webp",
      "tv_大佬": "093c1e2c490161aca397afc45573c877cdead616.png@32w_32h.webp",
      "tv_大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png@32w_32h.webp",
      "tv_委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png@32w_32h.webp",
      "tv_害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png@32w_32h.webp",
      "tv_尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png@32w_32h.webp",
      "tv_微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png@32w_32h.webp",
      "tv_思考": "90cf159733e558137ed20aa04d09964436f618a1.png@32w_32h.webp",
      "tv_惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png@32w_32h.webp",
      "doge": "3087d273a78ccaff4bb1e9972e2ba2a7583c9f11.png@32w_32h.webp",
    }
    })
</script>


  
</div>

<aside class="toc">
    <header>
    <strong>- 目录 -</strong>
    </header>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#开搞前-text">开搞前 text</a></li>
    <li><a href="#服务器的选择">服务器的选择</a></li>
    <li><a href="#误以为的安装过程">误以为的安装过程</a>
      <ul>
        <li><a href="#容器的安装目录和装载路径">容器的安装目录和装载路径</a></li>
        <li><a href="#启动容器">启动容器</a></li>
      </ul>
    </li>
    <li><a href="#真实的安装过程">真实的安装过程</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
</aside>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const observerForTableOfContentActiveState = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');

                if (entry.intersectionRatio > 0) {
                    clearActiveStatesInTableOfContents();
                    document.querySelector(`aside nav li a[href="#${id}"]`).parentElement.classList.add('active');
                }
            });
        });
        document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach((section) => {
            observerForTableOfContentActiveState.observe(section);
        });
    });

    function clearActiveStatesInTableOfContents() {
        document.querySelectorAll('aside nav li').forEach((section) => {
            section.classList.remove('active');
        });
    }
</script>


<footer id="footer">
    <script src="/js/prism.js"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="content">
        <p class="copyright">
            共 7 篇文章,合计 21080 字<br>
    
            <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><br>
    
           © Copyright 
           2021
            · 
           Powered by <a href="http://www.gohugo.io/">Hugo</a>
        </p>
    </div>

</footer></body>
</html>
